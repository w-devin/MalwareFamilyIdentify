rule EternalBlue_domain : EternalBlue
{
    meta:
        author = "w-devin<Mr.wyw@foxmail.com>"
        description = "domains of EternalBlue"
        date = "2020-10-30"
    strings:
        $url_1 = "d.ackng.com"
        $url_2 = "t.amynx.com"
    condition:
        any of them
}

rule EternalBlue_7p_php : EternalBlue
{
    meta:
        author = "w-devin<Mr.wyw@foxmail.com>"
        description = "7p.php of EternalBlue, downloader and runner of ipc.jsp/ipco.jsp"
        date = "2020-10-30"
    strings:
        $reg_match = "[regex]::matches" nocase
        $separator = "'+'"
        $join = "-join" nocase
        $matcher = "'rIg'+'HtTO'+'le'+'FT'" nocase  // strong rule, may delete
    condition:
        all of them
}

rule EternalBlue_powershell : EternalBlue
{
    meta:
        author = "w-devin<Mr.wyw@foxmail.com>"
        description = "EternalBlue windows scripts"
        date = "2020-10-30"
    strings:
        $iex = /i`*e`*x/ nocase
        $confusion_1 = "IO.StreamReader" nocase
        $confusion_2 = "IO.Compression.DeflateStream" nocase
        $confusion_3 = "IO.MemoryStream" nocase
        $confusion_4 = "[convert]::ToUInt32($_,16)"
        $confusion_5 = "[IO.Compression.CompressionMode]::Decompress"
        $confusion_6 = "[Text.Encoding]::ASCII)"
        $uint32_code = /[a-z0-9]{20,}/
    condition:
        $iex and $uint32_code and 2 of ($confusion_*)
}